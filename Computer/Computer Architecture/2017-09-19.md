## 2017-09-19

- The words of a computer's language are called __instructions__, and its vocabulary is called an __instruction set__.
- __Stored-program concept__: The idea that instructions and data of many types can be stored in memory as _numbers_, leading to the stored-program computer.
- MIPS instruction set architecture:
	- Operands: registers, memory words.
	- Operators: arithmetic, data transfer, logical, conditional branch, unconditional jump.
- Design principles:
	- Simplicity favors regularity.
	- Smaller is faster.
	- Good design demands good compromises.
- __Word__: The natural unit of access in a computer; corresponds to the size of a register in the MIPS architecture.
- __Registers__:
![fig2-14.jpg](https://github.com/b00401062/b00401062.github.io/blob/master/Computer/Computer%20Architecture/fig2-14.png?raw=true)
- It is the compiler's job to associate program variables with registers.
- __Memory words__:
	- To access a word in memory, the instruction must supply the memory _address_.
	- Expression in assembly language: offset(\$base register).
- __Data transfer instructions__: A command that moves data between memory and registers.
	- _Load_ values from memory into registers.
	- _Store_ result from register to memory.
- __Alignment restriction__: A requirement that data be aligned in memory on natural boundaries, e.g. multiples of 4 bytes in MIPS.
- The process of putting less commonly used variables (or those needed later) into memory is called __spilling__ registers.
- __Constants__ or __immediate operands__:
	- Constant data specified in an instruction.
	- Immediate operand avoids a load instruction.
- __Endianness__:
	- __Big-endian__: most-significant bit at least address of a word.
	- __Little-endian__: least-significant bit at least address of a word.
- Binary numbers:
	- __Two's complement__: $x+\bar{x} = -1$
	- __Sign extension__: replicate the sign bit to the left.
- Instructions are kept in the computer as a series of high and low electronic signals and may be represented as _numbers_.
- __Machine language__: the numeric version of instructions.
- The instruction formats are distinguished by the values in the first field (op).
- The desire to keep all instructions the same size is in conflict with the desire to have as many registers as possible.
- Most instruction sets today have 16 or 32 general purpose registers.
- __Binary compatibility__ often leads industry to align around a small number of instruction set architectures.
- Instruction fields:
	- _op_: __operation code (opcode)__.
	- _rs_: first source register number.
	- _rt_: second source register number.
	- _rd_: register destination operand.
	- _shamt_: shift amount.
	- _funct_: __function code__.
	- _constant_ or _address_.
- __Instruction format__: a form of representation of an instruction composed of fields of binary numbers.
![fig2-5.jpg](https://github.com/b00401062/b00401062.github.io/blob/master/Computer/Computer%20Architecture/fig2-5.jpg?raw=true)
- Operators and operations:
![fig2-1.png](https://github.com/b00401062/b00401062.github.io/blob/master/Computer/Computer%20Architecture/fig2-1.png?raw=true)
- __Basic block__: a sequence of instructions without branches (except possibly at the end), and without branch targets or branch labels (except possibly at the beginning).
- MIPS compilers use the slt, slti, beq, bne, and the fixed value of \$zero to create all relative conditions, and therefore, avoid higher cost of more complicated branch on less than.
	- `if (s0 <= s1) else`: `slt $t0, $s1, $s0`; `bne $t0, $zero, else`
	- `if (s0 < s1) else`: `slt $t0, $s0, $s1`; `beq $t0, $zero, else`
- Treating signed numbers as if they were unsigned gives us a low cost way of checking if 0 &le; x &lt; y, which matches the index out-of-bounds check for arrays.
- Implementing _switch_ is via a sequence of conditional tests, or via a __jump address table__ (or __jump table__), a table of addresses of alternative instruction sequences.
- __Jump register (jr)__ instruction is an unconditional jump to the address specified in a register.
- __Procedure__ (or __function__): a stored subroutine that performs a specific task based on the parameters with which it is provided.
- __Program counter (PC)__ is the register that contains the address of the instruction in the program being executed.
- __Jump-and-link (jal)__ instruction jumps to an address and simultaneously saves the address of the following instruction in register \$ra.
- The __jump register (jr)__ jumps to the address stored in register \$ra.
- The ideal data structure for spilling registers is a _stack_, which "grow" from higher addresses to lower addresses.
- The __stack pointer (\$sp)__ is adjusted by one word for each register that is saved or restored.
- __Temporary registers (\$t0–\$t9)__ are not preserved by the callee (called procedure) on a procedure call.
- __Saved registers (\$s0–\$s7)__ must be preserved on a procedure call (if used, the callee saves and restores them).
- One solution to nested procedures is to push all the other registers that must be preserved onto the stack.
- The stack is also used to store variables that are local to the procedure but do not fit in registers, such as local arrays or structures.
- __Procedure frame__ (or __activation record__):  the segment of the stack containing a procedure's saved registers and local variables.
- __Frame pointer (\$fp)__ points to the first word of the frame of a procedure.
- A frame pointer offers a stable base register within a procedure for local memory-references.
- The stack is adjusted only on entry and exit of the procedure.
- The MIPS memory allocation for program and data (from low to high): reserved, text segment (machine code), static data segment, heap, stack.
- Three choices for representing a string:
	- The first position of the string is reserved to give the length of a string.
	- An accompanying variable has the length of the string (as in a structure).
	- The last position of a string is indicated by a character used to mark the end of a string.
- MIPS' instructions to move bytes and _halfwords_: __load byte (lb)__, __store byte (sb)__, __load half (lh)__, __store half (sh)__.
- The MIPS instruction set includes the __instruction load upper immediate (lui)__ specifically to set the upper 16 bits of a constant in a register.
	- Load the upper 16 bits using _lui_.
	- Insert the lower 16 bits using _ori_.
- Either the compiler or the assembler must break large constants into pieces and then reassemble them into a register.
- The size of address is 16 bits in I-format or 26 bits in J-format.
- __Addressing modes__: addressing mode One of several addressing regimes delimited by their varied use of operands and/or addresses.
	- __Immediate addressing__: the operand is a constant within the instruction itself.
	- __Register addressing__: the operand is a register.
	- __Base or displacement addressing__: the operand is at the memory location whose address is the sum of a register and a constant in the instruction.
	- __PC-relative addressing__: the branch address is the sum of the PC and a constant in the instruction, i.e. _branch address_ = _program counter_ + _register_.
	- __Pseudodirect addressing__: the jump address is the 26 bits of the instruction concatenated with the upper bits of the PC.
- Conditional branches are found in loops and in if statements, so they tend to branch to a nearby instruction.
- If a branch target is too far away to be encoded with 16-bit offset, assembler rewrites the code and makes use of jump (j) instruction.
